<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="icon" href="img/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="css/chat.css">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,700&display=swap&subset=cyrillic-ext" rel="stylesheet">
    <meta name="author" content="Кулагин Александр">
	<meta name="copyright" content="MyOcean">
	<meta name="keywords" content="Star Wars, Mandalorec, Мандалорец, Episode IX, Скайуокер. Восход, Звездные войны">
	<meta name="description" content="Данный сайт содержит информацию о вселенной Звёздных войн.">
    <!-- FACEBOOK -->
	<meta property="og:locale" content="ru_RU">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Star Wars">
	<meta property="og:description" content="Сайт содержит информацию о вселенной Звездный Войн">
	<meta property="og:image" content="img/logo.png">
	<meta property="og:url" content="ПОКАЧТО ЕЕ НЕТ">
	<meta property="og:site_name" content="Star Wars">
	<!-- TWITTER -->
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="Iframe">
	<meta name="twitter:title" content="Star Wars">
	<meta name="twitter:description" content="Сайт содержит информацию о вселенной Звездный Войн">
	<meta name="twitter:image" content="img/logo.png">
    <title>StarWars Чат</title>
</head>
<body>
    <div class="wrapper" id="form">
        <div class="container-fluid">
            <div class="row logo">
                <div class="col">
                    <a class="logo" href="index.html"><img src="img/logo1.png"></a>
                </div>
            </div>
            <div class="row forms">
                <div class="col-3">
                    <input type="text" class="form-control inputName" placeholder="Введите ваше имя...">
                </div>
                <div class="col-7">
                    <input type="text" class="form-control inputText" placeholder="Введите ваше сообщение...">
                </div>
                <div class="col-2">
                    <button class="btn btn-outline-primary send" type="submit">Отправить</button>
                </div>
            </div>
            <div class="row fields">
                <div class="col-9">
                    <textarea class="text-field" disabled rows="19"></textarea>
                </div>
                <div class="col-3">
                    <button class="btn btn-danger btnDown">Вниз</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        let inpName = document.querySelector('.inputName')
        let inputText = document.querySelector('.inputText')
        let btn = document.querySelector('.send')
        let pole = document.querySelector('.text-field')
        let el = document.createElement('div')
        let btnDown = document.querySelector('.btnDown')

        btn.addEventListener('click', function() {
            axios.get('/send', {params:{user: inpName.value, text: inputText.value}})
            inpName.disabled = true
        })

        btnDown.addEventListener('click', function() {pole.scrollTop = pole.scrollHeight})
        
        btnDown.addEventListener('contextmenu', function(event) {event.preventDefault()})
        btn.addEventListener('contextmenu', function(event) {event.preventDefault()})

        function receiv() {
            axios.get('/recieve').then(function(response) {
                let messages = response.data
                for (message of messages) {
                    pole.value += message.user + ': ' + message.text + '\n'
                }
            })
        }

        let socket = new WebSocket('ws://localhost:1001')

        socket.onopen = function() {
            receiv()
            el.innerHTML = 'Новый пользователь присоединился в чат!'
            el.classList.add('alert')
            document.body.appendChild(el)
            setTimeout(function() {
                el.classList.remove('alert')
                el.remove()
            }, 3000)
        }

        socket.onmessage = function(event) {
            inputText.value = ''
            let message = JSON.parse(event.data)
            pole.value += message.user + ': ' + message.text + '\n'
        }
    </script> 
</body>
</html>